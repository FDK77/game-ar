<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Игра: Динамические звёзды</title>
    <!-- Подключаем A-Frame и AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
      // Компонент для обработки клика по звезде: удаляет объект и обновляет счёт
      AFRAME.registerComponent('clickable-star', {
        init: function () {
          this.el.addEventListener('click', () => {
            // Удаляем звезду из сцены
            this.el.parentNode.removeChild(this.el);
            // Обновляем счёт
            const scoreEl = document.querySelector('#scoreText');
            let currentScore = parseInt(scoreEl.getAttribute('value').replace('Score: ', '')) || 0;
            currentScore++;
            scoreEl.setAttribute('value', 'Score: ' + currentScore);
          });
        }
      });

      // Функция для динамического спавна звёзд вокруг пользователя
      function spawnStarsAroundUser(numStars) {
        const scene = document.querySelector('a-scene');
        // Получаем позицию камеры (если не установлена, принимаем (0,0,0))
        const camera = document.querySelector('a-camera');
        let camPos = camera.getAttribute('position') || { x: 0, y: 0, z: 0 };

        for (let i = 0; i < numStars; i++) {
          // Случайный угол и радиус для расположения звезды вокруг камеры
          let angle = Math.random() * 2 * Math.PI;
          let radius = 2 + Math.random() * 3; // от 2 до 5 метров
          let x = camPos.x + radius * Math.cos(angle);
          let z = camPos.z + radius * Math.sin(angle);
          let y = camPos.y; // на уровне камеры

          // Создаем сущность звезды
          let star = document.createElement('a-entity');
          star.setAttribute('gltf-model', 'star.glb');
          star.setAttribute('scale', '0.5 0.5 0.5');
          star.setAttribute('position', `${x} ${y} ${z}`);
          star.setAttribute('clickable-star', '');
          star.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 3000');

          scene.appendChild(star);
        }
      }

      window.onload = function() {
        // После загрузки сцены спавним звёзды
        const sceneEl = document.querySelector('a-scene');
        sceneEl.addEventListener('loaded', () => {
          spawnStarsAroundUser(10); // Спавним 10 звёзд
        });
      }
    </script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <!-- AR-сцена -->
    <a-scene embedded arjs="trackingMethod: best;">
      <!-- Камера с поддержкой GPS (если необходимо) -->
      <a-camera gps-camera>
        <!-- Счёт, прикреплённый к камере, всегда виден перед пользователем -->
        <a-text id="scoreText" value="Score: 0" position="0 -0.5 -1" scale="2 2 2" color="white"></a-text>
      </a-camera>
    </a-scene>
  </body>
</html>
